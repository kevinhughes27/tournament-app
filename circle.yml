machine:
  environment:
    ENV: circleci
    RACK_ENV: test
    RAILS_ENV: test
  ruby:
    version:
      2.2.2

dependencies:
  pre:
    - mkdir -p tmp/cache
  post:
    - bundle exec bundle-audit update && bundle exec bundle-audit check
    - npm install
    - npm install -g nsp
    - nsp check
  override:
    - bundle install --path .bundle --without production --without development
  cache_directories:
    - ".bundle"
    - "node_modules"

database:
  override:
    - bundle exec rake db:setup --trace
